<!--
author: 奶昔-王乃茜
date: 2017-04-27
title: React-组件间通信
tags: React
category: 前端
status: publish 
summary: React-组件之间的通信
-->
## 文章主要内容

    1. props和state
    2. setState
    3. 虚拟DOM
    4. 组件间通信

## 1.props和state

把组件看成一个函数，那么props是它接收的参数，state是它的内部参数。

---
### props
props是React用来让组件之间相互联系的一种机制。React的单向数据流，主要的流动管道就是props。

props是个只读属性，当我们试图改变props的原始值时，React会报错，组件的props一定是来自于默认属性（getDefaultProps）或通过父组件传递过来的（写在标签里）。如果说要渲染一个对props加工后的值，最简单的办法就是使用局部变量或直接在JSX中计算结果

---
### state
在使用state之前，需要在getInitialState中为state设置为一个默认值，然后才能通过this.state进行访问，可使用setState进行state的更改（在React中常常在事件处理方法中更新state）

当组件所需要的数据在调用时时已经确定的，不频繁发生变化的，就可以使用props来传递；如果所需要的数据在调用时不能确定，还会随着用户互动而产生变化的特性，例如ajax请求数据、一些事件，这时就需要使用state来记录和改变这些值

## 2.setState

React通过this.state来访问state，通过this.setState()方法来更新state。当this.setState()被调用时，React会重新调用render来重新渲染UI。但其实当你执行setState时，是将需要更新的state的值放到更新队列里，过一会才会将它们提取出来并合并到state中，是属于异步更新，并不是立刻更新this.state

setState()中可以传入对象也可以传入函数，当传入函数时，在函数中是可以操作最新的state的，因为传入的这个函数就相当于回调函数，它是在更新队列更新完之后才执行的，此时的state就是最新的state了

## 3.虚拟DOM

React中组件的DOM结构会映射到虚拟DOM上，虚拟DOM是一个树形js结构，当组件发生更新时，React会通过diff算法（对比这次的虚拟DOM结构和上次的虚拟DOM结构的区别）找到要变更的DOM节点，这时还是在虚拟DOM上，然后通过自身的逻辑和算法，将其转换为真实的DOM节点（patch方法），这里只是把变更的DOM节点转换到真实的DOM树上，属于局部操作并没有整体重新渲染真实的DOM树

diff算法:

         1.只进行同层的节点比较，如果出现跨层的操作，它并不会进行移动，而是先销毁消失的节点，再创建新的节点

         2.对同层节点进行比较时，diff算法提供三种操作：插入、移动、删除

patch方法：在diff阶段添加的差异节点会全部有序的添加到差异队列中，patch方法通过遍历差异队列，然后在真实DOM上进行相应的操作比如新节点的插入、已有节点的移动和删除等 

## 4.组件间通信

### 父组件向子组件通信

父组件通过props向子组件传递需要的信息，子组件通过this.props获取父组件的属性

直接在父组件中插入标签，在子组件中通过 this.props.属性名 进行获取传入的数据

### 子组件向父组件通信

通过回调函数进行通信

父子组件之间的通信主要是通过props

> 这里还需要再看一下，留着补充

### 兄弟组件之间通信

兄弟组件其实就是父 - 子，子 - 父的结合体

在这里一个组件向父组件传递了消息，父组件调用setState渲染的时候，另一个子组件因为也在父组件中就会受到渲染

如果是层级比较深的兄弟组件之间通信，通过这种方式会比较麻烦，也会浪费时间浪费资源，这时可以考虑Redux，这里没有学过redux，不进行说明

> 这里还是需要补充一下，留着深入学习一下再补充




